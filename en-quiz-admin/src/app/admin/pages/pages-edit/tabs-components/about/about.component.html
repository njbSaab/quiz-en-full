<!-- about.component.html -->
<section class="pages">
  <div class="flex items-center gap-4">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="48"
      height="48"
      viewBox="0 0 24 24"
      class="text-indigo-500"
    >
      <!-- иконка редактирования как в Terms -->
      <g
        fill="none"
        stroke="#6366f1"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
      >
        <path stroke-dasharray="20" stroke-dashoffset="20" d="M3 21h18">
          <animate
            fill="freeze"
            attributeName="stroke-dashoffset"
            dur="0.2s"
            values="20;0"
          />
        </path>
        <path
          fill="#6366f1"
          fill-opacity="0"
          stroke-dasharray="48"
          stroke-dashoffset="48"
          d="M7 17v-4l10 -10l4 4l-10 10h-4"
        >
          <animate
            fill="freeze"
            attributeName="fill-opacity"
            begin="1.1s"
            dur="0.5s"
            values="0;1"
          />
          <animate
            fill="freeze"
            attributeName="stroke-dashoffset"
            begin="0.2s"
            dur="0.6s"
            values="48;0"
          />
        </path>
        <path stroke-dasharray="8" stroke-dashoffset="8" d="M14 6l4 4">
          <animate
            fill="freeze"
            attributeName="stroke-dashoffset"
            begin="0.8s"
            dur="0.2s"
            values="8;0"
          />
        </path>
      </g>
    </svg>
    <h2 class="text-3xl font-bold text-indigo-600">Редактировать About</h2>
  </div>
  <div class="flex flex-row gap-12 items-start mt-8 pb-20">
    <!-- Левая часть: Редактор -->
    <div class="w-full max-w-[600px] space-y-6">
      <!-- Главный заголовок -->
      <div class="space-y-2">
        <label class="font-medium text-gray-700">Главный заголовок</label>
        <input
          [(ngModel)]="editableContent.title"
          (input)="onFieldChange()"
          class="input input-bordered w-full"
        />
      </div>

      <!-- Подзаголовок -->
      <div class="space-y-2">
        <label class="font-medium text-gray-700">Подзаголовок</label>
        <textarea
          [(ngModel)]="editableContent.subtitle"
          (input)="onFieldChange()"
          rows="3"
          class="textarea textarea-bordered w-full resize-none"
        ></textarea>
      </div>

      <!-- Список табов + редактирование активного -->
      <div class="space-y-6">
        <!-- Блок редактирования ТОЛЬКО активного таба -->
        <div *ngIf="editableContent.tabs.length > 0" class="mt-8">
          <div class="title-wrapper flex justify-between items-center mb-2">
            <h4 class="text-lg font-semibold flex items-center gap-2">
              <span
                class="btn btn-ghost btn-circle font-medium text-xl text-white"
                [class.bg-cyan-500]="getActiveTab()?.color === 'cayn'"
                [class.bg-fuchsia-500]="getActiveTab()?.color === 'fuchsia'"
                [class.bg-blue-500]="getActiveTab()?.color === 'center'"
              >
                {{ activeTabNumber }}
              </span>
              Табы:
              <span
                class="font-medium"
                [class.text-cyan-500]="getActiveTab()?.color === 'cayn'"
                [class.text-fuchsia-500]="getActiveTab()?.color === 'fuchsia'"
                [class.text-blue-500]="getActiveTab()?.color === 'center'"
              >
                {{ getActiveTab()?.label || '(Без названия)' }}
              </span>
            </h4>

            <div class="btn-group flex items-center gap-2">
              <button class="btn btn-success btn-sm" (click)="addTab()">
                + Добавить
              </button>
              <button
                class="btn btn-ghost btn-circle"
                (click)="removeTab(activeTabId)"
                [disabled]="editableContent.tabs.length === 0"
              >
                ❌
              </button>
            </div>
          </div>

          <div
            class="space-y-4 p-5 border-2 rounded-3xl bg-base-100"
            [class.border-cyan-300]="getActiveTab()?.color === 'cayn'"
            [class.border-fuchsia-300]="getActiveTab()?.color === 'fuchsia'"
            [class.border-blue-300]="getActiveTab()?.color === 'center'"
          >
            <!-- Текст в левом меню -->
            <div>
              <label class="label">
                <span class="label-text font-medium">Текст в меню (label)</span>
              </label>
              <input
                [(ngModel)]="getActiveTab()!.label"
                (input)="onFieldChange()"
                placeholder="Текст в левом меню..."
                class="input input-bordered w-full"
              />
            </div>

            <!-- Заголовок в аккордеоне -->
            <div>
              <label class="label">
                <span class="label-text font-medium"
                  >Заголовок в аккордеоне (title)</span
                >
              </label>
              <input
                [(ngModel)]="getActiveTab()!.title"
                (input)="onFieldChange()"
                placeholder="Заголовок раздела..."
                class="input input-bordered w-full"
              />
            </div>

            <!-- Цвет бордера -->
            <div>
              <label class="label">
                <span class="label-text font-medium">Цвет бордера</span>
              </label>
              <select
                [(ngModel)]="getActiveTab()!.color"
                (change)="onFieldChange()"
                class="select select-bordered w-full"
              >
                <option value="cayn">Циан (cayn)</option>
                <option value="fuchsia">Фуксия (fuchsia)</option>
                <option value="center">Синий (center)</option>
              </select>
            </div>

            <!-- Текст (HTML) -->
            <div>
              <label class="label">
                <span class="label-text font-medium">Текст раздела (HTML)</span>
              </label>
              <textarea
                [(ngModel)]="getActiveTab()!.body"
                (input)="onFieldChange()"
                rows="8"
                placeholder="Введите HTML-текст раздела..."
                class="textarea textarea-bordered w-full font-mono text-sm resize-none"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Если нет табов -->
        <div
          *ngIf="editableContent.tabs.length === 0"
          class="text-center py-12 text-gray-500 border-2 border-dashed rounded-xl"
        >
          Нет табов.<br />
          Нажмите "+ Добавить таб", чтобы создать первый.
        </div>
      </div>

      <!-- Кнопка сохранения и статус (внизу, как в Terms) -->
      <div class="flex items-center justify-between mt-8">
        <div class="flex flex-col items-center gap-4 w-full">
          <button
            class="btn btn-success btn-save"
            (click)="saveManually()"
            [disabled]="saving"
          >
            <span class="loading loading-spinner" *ngIf="saving"></span>
            Сохранить изменения
          </button>

          <div
            class="text-sm"
            [ngClass]="{
              'text-success': saveStatus === 'success',
              'text-error': saveStatus === 'error',
              'text-info': saveStatus === 'saving',
            }"
          >
            {{ saveMessage }}
            <span
              *ngIf="saveStatus === 'idle' && editableContent.tabs.length > 0"
            >
              Автосохранение через 1.5с после изменения
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Правая часть: Живое превью -->
    <div
      class="flex-1 bg-gray-900 rounded-2xl shadow-2xl overflow-hidden max-w-5xl"
    >
      <section class="h-space mb-8">
        <!-- Твой оригинальный шаблон превью, но с editableContent -->
        <div class="absolute inset-0 -z-10">
          <div
            class="absolute -top-40 left-1/2 -translate-x-1/2 h-[32rem] w-full lg:w-[32rem] rounded-full blur-3xl opacity-20"
            style="
              background: radial-gradient(
                closest-side,
                #a78bfa,
                transparent 70%
              );
            "
          ></div>
          <div
            class="absolute top-40 right-10 h-64 w-64 rounded-full blur-3xl opacity-25"
            style="
              background: radial-gradient(
                closest-side,
                #22d3ee,
                transparent 70%
              );
            "
          ></div>
        </div>

        <div class="container max-w-[850px] px-6 py-10 mx-auto">
          <h2
            class="text-2xl capitalize lg:text-3xl font-semibold tracking-tight cursor-pointer text-center lg:mb-6"
          >
            <span
              class="bg-gradient-to-r from-fuchsia-400 via-cyan-300 to-violet-400 bg-clip-text text-transparent"
            >
              {{ editableContent.title || 'Về chúng tôi...' }}
            </span>
          </h2>

          <p
            class="text-md md:text-xl text-center text-white opacity-70 w-[80%] mx-auto"
            [innerHTML]="editableContent.subtitle"
          ></p>

          <div class="mt-4 lg:mt-4 flex flex-col">
            <!-- Левое меню -->
            <div class="lg:mx-4">
              <div class="space-y-2 md:pt-4">
                <ng-container *ngFor="let tab of editableContent.tabs">
                  <p
                    class="block hover:text-cyan-500 transition-all cursor-pointer text-lg"
                    [ngClass]="{
                      'text-cyan-500':
                        activeTabId === tab.id && tab.color === 'cayn',
                      'text-fuchsia-500':
                        activeTabId === tab.id && tab.color === 'fuchsia',
                      'text-blue-500':
                        activeTabId === tab.id && tab.color === 'center',
                      'text-gray-300': activeTabId !== tab.id,
                    }"
                    (click)="setActiveTab(tab.id)"
                  >
                    - {{ tab.label }}
                  </p>
                </ng-container>
              </div>
            </div>

            <!-- Аккордеон -->
            <div class="flex-1 mt-4 lg:mx-12 lg:mt-0 text-balance">
              <ng-container
                *ngFor="let tab of editableContent.tabs; let i = index"
              >
                <div
                  class="collapse cursor-pointer border my-4 rounded-box"
                  [class.border-cyan-300]="[0, 3, 6, 9].includes(i)"
                  [class.border-fuchsia-300]="[1, 4, 7, 10].includes(i)"
                  [class.border-blue-300]="[2, 5, 8, 11].includes(i)"
                >
                  <input
                    type="radio"
                    name="about-accordion"
                    [checked]="activeTabId === tab.id"
                    (change)="setActiveTab(tab.id)"
                  />

                  <div
                    class="collapse-title font-semibold mx-4 text-xl text-white"
                  >
                    {{ tab.title }}
                  </div>

                  <div class="collapse-content flex">
                    <span
                      class="border ml-4"
                      [class.border-cyan-500]="tab.color === 'cayn'"
                      [class.border-fuchsia-500]="tab.color === 'fuchsia'"
                      [class.border-blue-500]="tab.color === 'center'"
                    ></span>
                    <p
                      class="max-w-3xl px-4 text-gray-500 dark:text-gray-300"
                      [innerHTML]="tab.body"
                    ></p>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</section>
