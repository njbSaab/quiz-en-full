<section class="pages">
  <div class="flex items-center gap-4">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="48"
      height="48"
      viewBox="0 0 24 24"
      class="text-indigo-500"
    >
      <g
        fill="none"
        stroke="#6366f1"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
      >
        <path stroke-dasharray="20" stroke-dashoffset="20" d="M3 21h18">
          <animate
            fill="freeze"
            attributeName="stroke-dashoffset"
            dur="0.2s"
            values="20;0"
          />
        </path>
        <path
          fill="#6366f1"
          fill-opacity="0"
          stroke-dasharray="48"
          stroke-dashoffset="48"
          d="M7 17v-4l10 -10l4 4l-10 10h-4"
        >
          <animate
            fill="freeze"
            attributeName="fill-opacity"
            begin="1.1s"
            dur="0.5s"
            values="0;1"
          />
          <animate
            fill="freeze"
            attributeName="stroke-dashoffset"
            begin="0.2s"
            dur="0.6s"
            values="48;0"
          />
        </path>
        <path stroke-dasharray="8" stroke-dashoffset="8" d="M14 6l4 4">
          <animate
            fill="freeze"
            attributeName="stroke-dashoffset"
            begin="0.8s"
            dur="0.2s"
            values="8;0"
          />
        </path>
      </g>
    </svg>
    <h2 class="text-3xl font-bold text-indigo-600">
      Редактировать Политику конфиденциальности (Policy)
    </h2>
  </div>

  <div class="flex flex-row gap-12 items-start mt-8 pb-20">
    <!-- Левая часть: Редактор -->
    <div class="w-full max-w-[600px] space-y-6">
      <!-- Основные поля -->
      <div class="space-y-4">
        <div>
          <label class="label font-medium">Главный заголовок</label>
          <input
            [(ngModel)]="editableContent.title"
            (input)="onFieldChange()"
            class="input input-bordered w-full"
          />
        </div>

        <div>
          <label class="label font-medium">Подзаголовок</label>
          <textarea
            [(ngModel)]="editableContent.subtitle"
            (input)="onFieldChange()"
            rows="3"
            class="textarea textarea-bordered w-full resize-none"
          ></textarea>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="label font-medium">Текст кнопки CTA</label>
            <input
              [(ngModel)]="editableContent.ctaText"
              (input)="onFieldChange()"
              class="input input-bordered w-full"
            />
          </div>
          <div>
            <label class="label font-medium">Ссылка кнопки CTA</label>
            <input
              [(ngModel)]="editableContent.ctaLink"
              (input)="onFieldChange()"
              class="input input-bordered w-full"
              placeholder="/quiz/3"
            />
          </div>
        </div>
      </div>

      <!-- Карточки -->
      <div class="space-y-6">
        <div class="flex justify-between items-center">
          <h3 class="text-xl font-semibold">Карточки</h3>
        </div>

        <!-- Редактирование активной карточки -->
        <div *ngIf="editableContent.cards.length > 0" class="mt-8">
          <div class="title-wrapper flex justify-between items-center mb-2">
            <h4 class="text-lg font-semibold flex items-center gap-2">
              <span
                class="btn btn-ghost btn-circle font-medium text-xl text-white"
                [class.bg-fuchsia-500]="
                  getActiveCard().color === 'fuchsia' ||
                  activeCardIndex % 3 === 0
                "
                [class.bg-blue-500]="
                  getActiveCard().color === 'center' ||
                  activeCardIndex % 3 === 1
                "
                [class.bg-cyan-500]="
                  getActiveCard().color === 'cayn' || activeCardIndex % 3 === 2
                "
              >
                {{ activeCardIndex + 1 }}
              </span>
              Редактирование:
              <span
                class="font-medium"
                [class.text-fuchsia-500]="
                  getActiveCard().color === 'fuchsia' ||
                  activeCardIndex % 3 === 0
                "
                [class.text-blue-500]="
                  getActiveCard().color === 'center' ||
                  activeCardIndex % 3 === 1
                "
                [class.text-cyan-500]="
                  getActiveCard().color === 'cayn' || activeCardIndex % 3 === 2
                "
              >
                {{ getActiveCard().title || '(Без заголовка)' }}
              </span>
            </h4>

            <div class="btn-group flex items-center">
              <button class="btn btn-success btn-sm" (click)="addCard()">
                + Добавить
              </button>
              <button
                class="btn btn-ghost btn-circle"
                (click)="$event.stopPropagation(); removeCard()"
              >
                ❌
              </button>
            </div>
          </div>

          <div
            class="space-y-4 p-5 border-2 rounded-3xl bg-base-100"
            [class.border-fuchsia-300]="
              getActiveCard().color === 'fuchsia' || activeCardIndex % 3 === 0
            "
            [class.border-blue-300]="
              getActiveCard().color === 'center' || activeCardIndex % 3 === 1
            "
            [class.border-cyan-300]="
              getActiveCard().color === 'cayn' || activeCardIndex % 3 === 2
            "
          >
            <div>
              <label class="label font-medium">Заголовок карточки</label>
              <input
                [(ngModel)]="getActiveCard()!.title"
                (input)="onFieldChange()"
                class="input input-bordered w-full"
              />
            </div>

            <div>
              <label class="label font-medium">Цвет (опционально)</label>
              <select
                [(ngModel)]="getActiveCard()!.color"
                (change)="onFieldChange()"
                class="select select-bordered w-full"
              >
                <option [ngValue]="undefined">Авто (по порядку)</option>
                <option value="fuchsia">Фуксия</option>
                <option value="center">Синий</option>
                <option value="cayn">Циан</option>
              </select>
            </div>

            <div>
              <label class="label font-medium">Текст карточки (HTML)</label>
              <textarea
                [(ngModel)]="getActiveCard()!.body"
                (input)="onFieldChange()"
                rows="8"
                class="textarea textarea-bordered w-full font-mono text-sm resize-none"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Если нет карточек -->
        <div
          *ngIf="editableContent.cards.length === 0"
          class="text-center py-12 text-gray-500 border-2 border-dashed rounded-xl"
        >
          Нет карточек.<br />
          Нажмите "+ Добавить карточку", чтобы создать первую.
        </div>
      </div>

      <!-- Кнопка сохранения и статус -->
      <div class="flex items-center justify-between mt-8">
        <div class="flex flex-col items-center gap-4 w-full">
          <button
            class="btn btn-success btn-save"
            (click)="saveManually()"
            [disabled]="saving"
          >
            <span class="loading loading-spinner" *ngIf="saving"></span>
            Сохранить изменения
          </button>

          <div
            class="text-sm"
            [ngClass]="{
              'text-success': saveStatus === 'success',
              'text-error': saveStatus === 'error',
              'text-info': saveStatus === 'saving',
            }"
          >
            {{ saveMessage }}
            <span
              *ngIf="saveStatus === 'idle' && editableContent.cards.length > 0"
            >
              Автосохранение через 1.5с после изменения
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Правая часть: Живое превью — статичные карточки -->
    <div class="flex-1 overflow-hidden bg-gray-900 rounded-2xl shadow-2xl">
      <section class="min-h-screen h-[1024px]">
        <div class="mx-auto max-w-screen-xl px-4 py-8 overflow-y-auto h-full">
          <div class="mx-auto max-w-lg text-center">
            <h2
              class="text-2xl capitalize lg:text-3xl font-semibold tracking-tight text-center"
            >
              <span
                class="bg-gradient-to-r from-fuchsia-400 via-cyan-300 to-violet-400 bg-clip-text text-transparent"
              >
                {{ editableContent.title || '關於我們...' }}
              </span>
            </h2>

            <p class="mt-[10px] md:mt-4 text-gray-300">
              {{ editableContent.subtitle }}
            </p>
          </div>

          <div class="mt-8 grid grid-cols-1 gap-8">
            <a
              *ngFor="let card of editableContent.cards; let i = index"
              class="bg-gradient-blue-180 block rounded-xl p-8 shadow-xl transition hover:shadow-none cursor-pointer"
              [class.bg-shadow-fuchsia]="
                card.color === 'fuchsia' || i % 3 === 0
              "
              [class.bg-shadow-center]="card.color === 'center' || i % 3 === 1"
              [class.bg-shadow-cayn]="card.color === 'cayn' || i % 3 === 2"
              (click)="activeCardIndex = i"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="size-10"
                [class.text-fuchsia-500]="
                  card.color === 'fuchsia' || i % 3 === 0
                "
                [class.text-blue-300]="card.color === 'center' || i % 3 === 1"
                [class.text-cyan-300]="card.color === 'cayn' || i % 3 === 2"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  fill="currentColor"
                  d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12c5.16-1.26 9-6.45 9-12V5zm2.5 11.59l.9 3.88l-3.4-2.05l-3.4 2.05l.9-3.87l-3-2.59l3.96-.34L12 6.02l1.54 3.64l3.96.34z"
                />
              </svg>

              <h2 class="mt-4 text-xl font-bold text-white">
                {{ card.title }}
              </h2>

              <p class="mt-1 text-sm text-gray-300" [innerHTML]="card.body"></p>
            </a>
          </div>

          <a
            [routerLink]="editableContent.ctaLink || '/quiz/3'"
            class="w-fit mx-auto mt-8 flex items-center justify-center rounded-2xl px-5 py-3 text-sm sm:text-base font-semibold bg-gradient-to-r from-fuchsia-500 to-cyan-400 text-slate-950 shadow-lg shadow-fuchsia-500/20 hover:opacity-95 transition block"
          >
            {{ editableContent.ctaText || '立即開始...' }}
          </a>
        </div>
      </section>
    </div>
  </div>
</section>
